<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comunidade / MESCLA</title>
    <link href="/styles/fonts.css" rel="stylesheet" />
    <link href="/styles/media.css" rel="stylesheet" />
    <link rel="icon" href="components/images/mesclaM.png" type="image/x-icon">
    <link href="/styles/comunidade.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      .section {
        display: none;
      }
      .active {
        display: block;
      }
      .sidebar ul li a.selected {
        background-color: #3cca94;
        color: #333;
      }

      .post {
        background-color: #202020; /* Fundo da publica√ß√£o */
        color: #fff; /* Cor do texto */
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      .post h3 {
        margin-bottom: 10px;
        font-size: 18px;
      }

      .post p {
        margin: 0;
      }

      .content h2 {
        margin-bottom: 20px; /* Espa√ßamento entre o t√≠tulo e as publica√ß√µes */
      }

      .announcement {
        background-color: #202020; /* Fundo do an√∫ncio */
        color: #fff; /* Cor do texto */
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
      }

      .announcement p {
        margin-bottom: 10px; /* Espa√ßamento entre os par√°grafos */
      }

      .announcement img {
        width: 100%; /* Faz a imagem ocupar 100% da largura do container */
        border-radius: 5px;
        margin-top: 10px; /* Espa√ßamento entre o texto e a imagem */
      }

      .outer {
        margin-bottom: 10px;
        display: flex;
        align-items: center;
      }
      .me {
        background-color: #00d1b2;
        color: #000;
        border-radius: 15px;
        padding: 10px;
        max-width: 50%;
        position: relative;
        margin-left: auto; /* Alinha mensagens 'me' √† direita */
      }
      .notMe {
        background-color: #3cca94;
        color: #000;
        border-radius: 15px;
        padding: 10px;
        max-width: 50%;
        position: relative;
        margin-right: auto; /* Alinha mensagens 'notMe' √† esquerda */
      }
      .me img,
      .notMe img {
        margin-top: 5px;
        border-radius: 5px;
      }
      .delete-btn {
        background-color: #ff3860;
        border: none;
        color: white;
        padding: 5px;
        border-radius: 50%;
        cursor: pointer;
        margin-left: 10px;
        transition: 0.3s ease-in-out;
      }
      .delete-btn:hover {
        background-color: #ff1744;
      }
    </style>
    <script src="auth.js"></script>
    <script>
      let sender = ""; // Vari√°vel global para o nome do usu√°rio

      function showSection(sectionId, element) {
        const sections = document.querySelectorAll(".section");
        sections.forEach((section) => section.classList.remove("active"));
        const activeSection = document.getElementById(sectionId);
        activeSection.classList.add("active");

        const links = document.querySelectorAll(".sidebar ul li a");
        links.forEach((link) => link.classList.remove("selected"));
        element.classList.add("selected");

        // Exibir prompt para inserir nome apenas quando a aba "Chat" for acessada
        if (sectionId === "chat-section" && !sender) {
          sender = prompt("Digite o nome de usu√°rio que deseja usar no chat:");
          if (!sender) {
            sender = "Usu√°rio An√¥nimo"; // Define um nome padr√£o se o campo estiver vazio
          }
        }
      }
    </script>
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <h2>Comunidade</h2>
        <ul>
          <li>
            <a
              href="#"
              id="bairro-tab"
              onclick="showSection('bairro-section', this)"
            >
              <i class="fa-solid fa-house"></i> Bairro
            </a>
          </li>
          <li>
            <a
              href="#"
              id="prefeitura-tab"
              onclick="showSection('prefeitura-section', this)"
            >
              <i class="fa-solid fa-landmark"></i> Prefeitura
            </a>
          </li>
          <li>
            <a
              href="#"
              id="chat-tab"
              onclick="showSection('chat-section', this)"
            >
              <i class="fa-solid fa-message"></i> Chat
            </a>
          </li>
          <li>
            <a
              href="#"
              id="empresas-tab"
              onclick="showSection('empresas-section', this)"
            >
              <i class="fas fa-building"></i> Empresas
            </a>
          </li>
        </ul>
      </div>
      <div class="content">
        <div id="bairro-section" class="section active">
          <div class="post">
            <h3>Lucas Santos</h3>
            <p>A fia√ß√£o el√©trica da Santa B√°rbara est√° horr√≠vel!</p>
          </div>

          <div class="post">
            <h3>Davi</h3>
            <p>
              Voltamos para a √©poca da pedra? Cad√™ a energia el√©trica na Santa
              B√°rbara?
            </p>
          </div>

          <div class="post">
            <h3>Vin√≠cius</h3>
            <p>
              Meu computador n√£o funciona com manivela n√£o! Onde est√° a energia
              da Santa B√°rbara?
            </p>
          </div>
        </div>
        <div id="prefeitura-section" class="section">
          <div class="announcement">
            <h3>Prefeitura de Santa Rita do Sapuca√≠</h3>
            <p>
              A Prefeitura de Santa Rita do Sapuca√≠ tem o prazer de convidar
              toda a popula√ß√£o para a comemora√ß√£o do Dia das Crian√ßas! Venha se
              divertir com muitas atra√ß√µes e atividades para toda a fam√≠lia.
              üéà‚ú®
            </p>
            <p><strong>üóì Data:</strong> 12 de Outubro</p>
            <p><strong>üìç Local:</strong> Pra√ßa Central</p>
            <p><strong>‚è∞ Hor√°rio:</strong> 14h √†s 18h</p>
            <p>
              Teremos brinquedos infl√°veis, apresenta√ß√µes teatrais, distribui√ß√£o
              de pipoca e algod√£o doce, al√©m de muitas outras surpresas. N√£o
              perca! üéäüéÅ
            </p>
            <img
              src="https://i.ytimg.com/vi/b6z7qE9nBhI/maxresdefault.jpg"
              alt="Evento Dia das Crian√ßas"
            />
          </div>
        </div>
        <div id="chat-section" class="section">
          <h2>Chat:</h2>
          <div id="messages" class="chat-messages"></div>
          <div class="chat-input">
            <i id="attachBtn" class="fas fa-paperclip attach-icon"></i>
            <input
              type="text"
              id="msgTxt"
              placeholder="Digite sua mensagem..."
            />
            <i id="msgBtn" class="fas fa-paper-plane send-icon"></i>
            <input type="file" id="fileInput" style="display: none" />
          </div>
        </div>
        <div id="empresas-section" class="section">
          <div class="announcement">
            <h3>Cemig - Companhia Energ√©tica de Minas Gerais</h3>
            <p>
              A Cemig informa que h√° instabilidades na energia el√©trica em
              alguns bairros de Santa Rita do Sapuca√≠. Nossas equipes j√° est√£o
              mobilizadas para identificar e solucionar os problemas.
            </p>
            <p>
              Pedimos a compreens√£o de todos e informamos que a previs√£o para a
              normaliza√ß√£o do servi√ßo √© at√© o final do dia.
            </p>
            <p>
              <strong
                >‚ö†Ô∏è Se voc√™ estiver enfrentando problemas, por favor, entre em
                contato com o nosso atendimento ao cliente.</strong
              >
              <img
                src="https://eixos.com.br/wp-content/plugins/seox-image-magick/imagick_convert.php?width=904&height=508&format=.jpeg&quality=91&imagick=uploads.eixos.com.br/2023/07/eletricistas-trabalho-scaled-cemig-1140x570.jpeg"
                alt="Cemig trabalhando"
              />
            </p>
          </div>
        </div>
      </div>
    </div>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        set,
        onChildAdded,
        remove,
      } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
      import {
        getStorage,
        ref as storageRef,
        uploadBytes,
        getDownloadURL,
      } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCBzItoPtnnZL3qZzaugxDwnzja2g_ddas",
        authDomain: "mescla-f9d00.firebaseapp.com",
        projectId: "mescla-f9d00",
        storageBucket: "mescla-f9d00.appspot.com",
        messagingSenderId: "442057041731",
        appId: "1:442057041731:web:a5d7208555136ba97531f6",
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const storage = getStorage(app);

      const msgTxt = document.getElementById("msgTxt");
      const msgBtn = document.getElementById("msgBtn");
      const attachBtn = document.getElementById("attachBtn");
      const fileInput = document.getElementById("fileInput");
      const messagesContainer = document.getElementById("messages");

      const sendMsg = (msg, imageUrl = null) => {
        const timestamp = new Date().getTime();
        set(ref(db, "messages/" + timestamp), {
          msg: msg || "",
          imageUrl: imageUrl || "",
          sender: sender,
        });
        msgTxt.value = "";
      };

      window.deleteMsg = (id) => {
        remove(ref(db, "messages/" + id)).then(() => {
          const element = document.getElementById(id);
          if (element) {
            element.remove();
          }
        });
      };

      onChildAdded(ref(db, "messages"), (data) => {
        const messageClass = data.val().sender === sender ? "me" : "notMe";
        const deleteButton =
          data.val().sender === sender
            ? `<button class="delete-btn" onclick="deleteMsg('${data.key}')">&times;</button>`
            : "";
        const messageHtml = `
                <div class="outer" id="${data.key}">
                    <div class="${messageClass}">
                        ${
                          data.val().sender === sender
                            ? "Voc√™: "
                            : data.val().sender + ": "
                        }
                        ${data.val().msg}
                        ${
                          data.val().imageUrl
                            ? `<img src="${
                                data.val().imageUrl
                              }" style="max-width: 200px;" />`
                            : ""
                        }
                    </div>
                    ${deleteButton}
                </div>`;
        messagesContainer.innerHTML += messageHtml;
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      });

      msgBtn.addEventListener("click", () => sendMsg(msgTxt.value));
      attachBtn.addEventListener("click", () => fileInput.click());

      fileInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (file) {
          const timestamp = new Date().getTime();
          const storagePath = storageRef(
            storage,
            "images/" + timestamp + "_" + file.name
          );
          uploadBytes(storagePath, file).then((snapshot) => {
            getDownloadURL(snapshot.ref).then((url) => sendMsg(null, url));
          });
        }
      });
    </script>
  </body>
</html>